<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <!-- <meta http-equiv="X-UA-Compatible" content="IE=8"> -->
<meta http-equiv="Expires" content="0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-control" content="no-cache">
<meta http-equiv="Cache" content="no-cache">
  <title>数据可视化</title>
  <link rel="stylesheet" href="../../asset/introduce/layui/css/layui.css">
  <link rel="stylesheet" href="../../asset/css/reset.css">
  <link rel="stylesheet" href="../../asset/css/common.css">
  <link rel="stylesheet" href="./index-bkp.css">
</head>
<body>
  <!--头部-->
  <div class="header">
    <a class="header-lt" id="header" href="../index/index.html"></a>
    <div class="header-rt">
      <ul>
        <li class="notice-wrapper">
          <img class="notice-icon" src="../../asset/img/notice.png" alt="通知">
        </li>
        <li class="user-notice">
          <div id="user-operate" class="user-operate">
            <a href="javascript:;">
              <img class="user-img" src="../../asset/img/logo.png" alt="头像">
              管理
            </a>
            <a href="javascript:;" class="exit" title="退出">退出</a>
          </div>
        </li>
      </ul>
    </div>
  </div>
  <!-- 固定勤务 -->
  <dl class="wrapper">
    <dd class="data-vsualize">
      <ul class="data-left">
        <li class="dv-chart-box">
          <div class="dv-bg">
            <i class="dvbg-right-lt unormal"></i>
            <i class="dvbg-left-mt"></i>
            <i class="dvbg-left-rt"></i>
            <i class="dvbg-left-lm"><img src="../../asset/img/dv-left-lm-img.png"></i>
            <i class="dvbg-left-mm"></i>
            <i class="dvbg-left-rm"></i>
            <i class="dvbg-left-lb"></i>
            <i class="dvbg-left-mb"></i>
            <i class="dvbg-left-rb"></i>
          </div>
          <div class="dv-chart">
            <h4 class="dv-chart-title">执勤汇总</h4>
            <div class="dv-chart-main">
              <div class="div-chart-bar" id="onDuty"></div>
            </div>
          </div>
        </li>

        <li class="dv-chart-box dv-bg-center">
          <div class="dv-bg">
            <i class="dvbg-middle-lt"></i>
            <i class="dvbg-middle-rt"></i>
            <i class="dvbg-middle-rb"></i>
            <i class="dvbg-middle-lb"></i>
          </div>
          <div class="dv-chart">
            <h4 class="dv-chart-title">异常值勤趋势图</h4>
            <div class="dv-chart-main dv-chart-duty">
              <div class="dv-chart-duty-trend" id="dutyTrend"></div>
            </div>
          </div>
        </li>

        <li class="dv-chart-box">
          <div class="dv-bg">
            <i class="dvbg-right-lt unormal"></i>
            <i class="dvbg-left-mt"></i>
            <i class="dvbg-left-rt"></i>
            <i class="dvbg-left-lm"><img src="../../asset/img/dv-left-lm-img.png"></i>
            <i class="dvbg-left-mm"></i>
            <i class="dvbg-left-rm"></i>
            <i class="dvbg-left-lb"></i>
            <i class="dvbg-left-mb"></i>
            <i class="dvbg-left-rb"></i>
          </div>
          <div class="dv-chart">
            <h4 class="dv-chart-title">查勤统计</h4>
            <div class="dv-chart-main">
              <div class="duty-statistics" id="dutyStatistics"></div>
            </div>
          </div>
        </li>
      </ul>

      <ul class="data-middle">
        <li class="dv-title">
          <i class="dvbg-title-l"></i>
          <i class="dvbg-title-m"></i>
          <i class="dvbg-title-r"></i>
          <img src="../../asset/img/dv-title.png" alt="数据可视化">
        </li>

        <li class="dv-map">
          <div class="dv-map-bg">
            <i class="bg-conner conner-lt"></i>
            <i class="bg-conner conner-rt"></i>
            <i class="bg-conner conner-lb"></i>
            <i class="bg-conner conner-rb"></i>
          </div>
          <img class="hot-bg" src="../../asset/img/hot-bg.png" alt="热力图">
        </li>
      </ul>

      <ul class="data-right">
        <li class="dv-chart-box dv-chart-index">
          <div class="dv-bg">
            <i class="dvbg-right-lt"></i>
            <i class="dvbg-right-mt"></i>
            <i class="dvbg-right-rt"></i>
            <i class="dvbg-right-lm"></i>
            <i class="dvbg-right-mm"></i>
            <i class="dvbg-right-rm"><img src="../../asset/img/dv-right-rm-img.png"></i>
            <i class="dvbg-right-lb"></i>
            <i class="dvbg-right-mb"></i>
            <i class="dvbg-right-rb"></i>
          </div>
          <div class="dv-chart">
            <h4 class="dv-chart-title">分类报警统计</h4>
            <div class="dv-chart-icons">
              <ul>
                <li>
                  周界
                  <span class="statis-around" id="showAround">43</span>
                  <div class="popover popover-around">
                    <div class="pop-title">周界</div>
                    <div class="pop-chart" id="aroundChart"></div>
                  </div>
                </li>
              </ul>
              <ul>
                <li>
                  手按
                  <span class="statis-press" id="showPress">64</span>
                  <div class="popover">
                    <div class="pop-title">手按</div>
                    <div class="pop-chart" id="pressChart"></div>
                  </div>
                </li>
              </ul>
              <ul>
                <li>
                  枪支离岗
                  <span class="statis-gun" id="qiangzhi">0</span>
                </li>
              </ul>
              <ul>
                <li>
                  无人机反制
                  <span class="no-people" id="plane">36</span>
                </li>
              </ul>
            </div>
          </div>
        </li>

        <li class="dv-chart-box dv-bg-center">
          <div class="dv-bg">
            <i class="dvbg-middle-lt"></i>
            <i class="dvbg-middle-rt"></i>
            <i class="dvbg-middle-rb"></i>
            <i class="dvbg-middle-lb"></i>
          </div>
          <div class="dv-chart">
            <h4 class="dv-chart-title">报警趋势图</h4>
            <div class="dv-chart-main">
              <div class="police-trend" id="alarmTrend"></div>
            </div>
          </div>
        </li>

        <li class="dv-chart-box">
          <div class="dv-bg">
            <i class="dvbg-right-lt"></i>
            <i class="dvbg-right-mt"></i>
            <i class="dvbg-right-rt"></i>
            <i class="dvbg-right-lm"></i>
            <i class="dvbg-right-mm"></i>
            <i class="dvbg-right-rm"><img src="../../asset/img/dv-right-rm-img.png"></i>
            <i class="dvbg-right-lb"></i>
            <i class="dvbg-right-mb"></i>
            <i class="dvbg-right-rb"></i>
          </div>
          <div class="dv-chart">
            <h4 class="dv-chart-title">有效警情记录</h4>
            <div class="dv-chart-main">
              <img class="no-record" src="../../asset/img/no-record.png" alt="暂无记录">
            </div>
          </div>
        </li>
      </ul>

      <span class="clearfix"></span>
    </dd>
    <div class="dv-table pos-table">
      <i class="bg-conner conner-lt"></i>
      <i class="bg-conner conner-rt"></i>
      <i class="bg-conner conner-lb"></i>
      <i class="bg-conner conner-rb"></i>
      <input type="text" name="notautosubmit" style="display:none"/>
      <form class="layui-form">
        <div class="layui-form-item">
          <div class="layui-inline">
            <label class="layui-form-label">开始时间：</label>
            <div class="layui-input-inline">
              <input type="text" name="startTime" id="startTime" autocomplete="off" placeholder="开始时间"
                     class="layui-input js-laydate">
            </div>
          </div>

          <div class="layui-inline">
            <label class="layui-form-label">结束时间：</label>
            <div class="layui-input-inline">
              <input type="text" name="endTime" id="endTime" autocomplete="off" placeholder="结束时间"
                     class="layui-input js-laydate">
            </div>
          </div>

          <div class="layui-inline">
            <label class="layui-form-label">报警类型：</label>
            <div class="layui-input-inline">
              <select id="alarmType" name="alarmType">
                <option value=""></option>
                <option value="81">激光对射</option>
                <option value="302">绊线入侵</option>
                <option value="303">区域入侵</option>
                <option value="309">快速移动</option>
                <option value="594">声音异常</option>
                <option value="596">攀高入侵</option>
                <option value="2602">震动光纤</option>
              </select>
            </div>
          </div>

          <div class="layui-inline">
            <label class="layui-form-label">报警级别：</label>
            <div class="layui-input-inline">
              <select id="alarmLevel" name="alarmLevel">
                <option value=""></option>
                <option value="1">一级报警</option>
                <option value="2">二级报警</option>
                <option value="3">三级报警</option>
              </select>
            </div>
          </div>

          <div class="layui-inline">
            <button type="button" class="layui-btn layui-btn-normal js-btn-search">查询</button>
            <!--<button class="layui-btn layui-btn-primary">导出</button>-->
          </div>

        </div>
      </form>
      <table class="layui-hide" id="alarmList"></table>
    </div>
    <a href="javascript:;" class="icon-table js-table" alt="1">
      <img src="../../asset/img/icon_fold.png" alt="fold">
    </a>
  </dl>
  <script src="../../asset/js/jquery.min.js"></script>
  <script src="../../asset/js/config.js"></script>
  <script type='text/javascript' src='/dwr/engine.js'></script>
<script type='text/javascript' src='/dwr/interface/DwrImpl.js'></script>
<script type='text/javascript' src='/dwr/util.js'></script>
  <script src="../../asset/js/utils.js"></script>
  <script src="../../asset/js/echarts.min.js"></script>
  <script src="../../asset/introduce/layui/layui.js"></script>
  <script>
      layui.use(['laydate', 'table'], function () {
          var laydate = layui.laydate;
          $('.js-laydate').each(function(){
              var elm = $(this).attr('id');
              laydate.render({
                  elem: '#' + elm,
                  format: 'yyyy-MM-dd'
              })
          })

          var table = layui.table;
          $('body')
              .on('click', '.js-btn-search', function () {
                  renderTable();
              })
              .on('click', '.js-table', function () {
                  $tis = $(this);
                  var _alt = $tis.attr('alt')
                  if (_alt == '1') {
                      $tis.attr('alt', '2')
                      $tis.children('img').attr('src', '../../asset/img/icon_expand.png')
                      $('.pos-table').animate({right:'80px'});
                      renderTable();
                  }else {
                      $tis.attr('alt', '1')
                      $tis.children('img').attr('src', '../../asset/img/icon_fold.png')
                      $('.pos-table').animate({right:'-1020px'})
                  }
              })

          function renderTable(){
              var startTime = $('#startTime').val();
              var endTime = $('#endTime').val();
              var alarmType = $('#alarmType').val();
              var alarmLevel = $('#alarmLevel').val();
              var where = {
                  startTime: startTime,
                  endTime: endTime,
                  alarmType: alarmType,
                  alarmLevel: alarmLevel
              }
              table.render({
                  elem: '#alarmList'
                  ,url: $ctx + '/alarm/findAlarmList'
                  ,method: 'get'
                  ,page: true //开启分页
                  ,layout: ['count', 'prev', 'page', 'next']
                  ,skin: 'nob' //重要属性：无连线表格
                  ,cols: [[ //标题栏
                      {type:'checkbox', width: 50}
                      ,{type:  'numbers', title: '序号', width: 70}
                      ,{field: 'cameraID', title: '报警通道', minWidth: 120}
                      ,{field: 'typeName', title: '报警类型', style: 'color: #f69506;', width: 100}
                      ,{field: 'alarmTime', title: '报警时间', minWidth: 120}
                      ,{field: 'levelName', title: '报警级别', style: 'color: #07dcef;', width: 100}
                      ,{field: 'processResult', title: '处理结果', width: 100}
                      ,{field: 'processTime', title: '处理时间', minWidth: 120}
                  ]],
                  parseData: function(res){ //res 即为原始返回的数据
                      return {
                          "code": res.code, //解析接口状态
                          "msg": res.message, //解析提示文本
                          "count": res.data.total, //解析数据长度
                          "data": res.data.list //解析数据列表
                      };
                  },
                  where: where
              });
          }
      })
      setTimeout(function () {
        // 执勤汇总柱状图
        var onDuty = echarts.init(document.getElementById('onDuty'));
        var dutyOption = {
          tooltip : {
            trigger: 'axis',
            axisPointer : {            // 坐标轴指示器，坐标轴触发有效
              type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
            }
          },
          grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
          },
          xAxis: {
            type: 'category',
            axisLabel: {
              color: '#797894'
            },
            axisLine: {
              show: true,
              lineStyle: {
                color: '#9f9fb3'
              }
            },
            data: ['1月','2月','3月','4月','5月','6月']
          },
          yAxis:  {
            type: 'value',
            name : '单位（人）',
            splitLine: {
              show: true,
              lineStyle: {
                color: ['#22366d'],
                width: 1,
                type: 'dotted'
              }
            },
            axisLine: {
              show: true,
              lineStyle: {
                color: '#9f9fb3'
              }
            },
            axisLabel: {
              color: '#797894'
            }
          },
          series: [
            {
              name: '正常',
              type: 'bar',
              stack: '总量',
              barCategoryGap:'45%',
              label: {
                normal: {
                  show: false,
                  position: 'insideRight'
                }
              },
              data: [89, 85, 79, 88, 81,30]
            },
            {
              name: '异常',
              type: 'bar',
              stack: '总量',
              barCategoryGap:'45%',
              label: {
                normal: {
                  show: false,
                  position: 'insideRight'
                }
              },
              data: [20, 19, 14, 12, 11,9]
            }
          ],
          color: ['#325df9','#ff2d55']
        };
        onDuty.setOption(dutyOption);
        // 图表：异常执勤趋势
        var trendChart = echarts.init(document.getElementById('dutyTrend'));
        var dutyTrendOtion = {
          xAxis: {
            type: 'category',
            data: ['1月', '2月', '3月', '4月', '5月','6月'],
            axisLine: {
              show: true,
              lineStyle: {
                color: '#4ec1ee'
              }
            },
            axisLabel: {
              color: '#797894'
            },
            axisTick: {
              show: false
            },
            splitLine: {
              show: true,
              lineStyle: {
                color: ['#22366d'],
                width: 1,
                type: 'dotted'
              }
            },
            boundaryGap: false //顶头渲染
          },
          yAxis: [{
            name : '单位（次）',
            nameTextStyle: {
              color: '#797894'
            },
            type: 'value',
            axisLine: {
              show: true,
              lineStyle: {
                color: '#4ec1ee'
              }
            },
            axisLabel: {
              color: '#797894'
            },
            axisTick: {
              show: false
            },
            splitLine: {
              show: true,
              lineStyle: {
                color: ['#22366d'],
                width: 1,
                type: 'dotted'
              }
            }
          }],
          grid: {
            top: '13%',
            bottom: '16%',
            left: '10%',
            right: '3%',
          },
          series: [{
            data: [32.5, 26.2, 24.1, 20.5, 19,12],
            type: 'line',
            smooth: true, //折现光滑
            symbol: 'none', //取消这点圆圈
            areaStyle: {
              opacity: 0.2,
              color: { //线性渐变
                type: 'linear',
                x: 0,
                y: 0,
                x2: 0,
                y2: 1,
                colorStops: [{
                  offset: 0,
                  color: '#ff2d55' // 0% 处的颜色
                }, {
                  offset: 1,
                  color: '#191045' // 100% 处的颜色
                }],
                global: false // 缺省为 false
              }
            }, //出现阴影
            lineStyle: {
              width: 6,

              color: { //线性渐变
                type: 'linear',
                x: 0,
                y: 0,
                x2: 1,
                y2: 1,
                colorStops: [{
                  offset: 0,
                  color: '#ff2d55' // 0% 处的颜色
                }, {
                  offset: 1,
                  color: '#ff2d55' // 100% 处的颜色
                }],
                global: false // 缺省为 false
              }
            },
            markPoint: {
              label: {

              },
              data: [{
                name: '最大值',
                type: 'max'
              }]
            }
          }]

        };
        trendChart.setOption(dutyTrendOtion);

        // 查勤统计
        var dutyStatistics = echarts.init(document.getElementById('dutyStatistics'));
        var dutyStatisticsOption = {
          tooltip : {
            trigger: 'axis',
            axisPointer : {            // 坐标轴指示器，坐标轴触发有效
              type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
            }
          },
          xAxis : [
            {
              type : 'category',
              data : ['1月','2月','3月','4月','5月','6月'],
              axisTick: {
                show: false
              },
              splitLine: {
                show: false
              },
              axisLabel: {
                color: '#797894'
              }
            }
          ],
          yAxis : [
            {
              type : 'value',
              name : '单位（次）',
              nameTextStyle: {
                color: '#797894'
              },
              splitLine: {
                show: false
              },
              axisTick: {
                show: false
              },
              axisLine: {
                show: true,
                lineStyle: {
                  color: '#4a9bef'
                }
              },
              axisLabel: {
                color: '#797894'
              }
            }
          ],
          series : [
            {
              name:'网络查勤',
              type:'bar',
              barGap:'10%',/*多个并排柱子设置柱子之间的间距*/
              barCategoryGap:'30%',
              data:[52, 54, 47, 46, 45,2]
            },
            {
              name:'实地查勤',
              type:'bar',
              barGap:'10%',/*多个并排柱子设置柱子之间的间距*/
              barCategoryGap:'30%',
              data:[42, 45, 39, 36, 38,3]
            }
          ],
          color: ['#325df9', '#ff9745']
        };
        dutyStatistics.setOption(dutyStatisticsOption);

        // 报警趋势图
        var alarmTrend = echarts.init(document.getElementById('alarmTrend'));
        var alarmTrendOption = {
          xAxis: {
            type: 'category',
            data: ['1月', '2月', '3月', '4月', '5月','6月'],
            axisLine: {
              show: false
            },
            axisLabel: {
              color: '#797894'
            },
            axisTick: {
              show: false
            },
            boundaryGap: false //顶头渲染
          },
          yAxis: [{
            type: 'value',
            axisLine: {
              show: false
            },
            axisLabel: {
              color: '#797894'
            },
            axisTick: {
              show: false
            },
            splitLine: {
              show: true,
              lineStyle: {
                color: ['#22366d'],
                width: 1,
                type: 'solid'
              }
            }
          }],
          grid: {
            top: '13%',
            bottom: '16%',
            left: '10%',
            right: '3%',
          },
          series: [{
            data: [74, 63, 57, 53, 52,2],
            type: 'line',
            smooth: true, //折现光滑
            symbol: 'none', //取消这点圆圈
            areaStyle: {
              opacity: 0.2,
              color: { //线性渐变
                type: 'linear',
                x: 0,
                y: 0,
                x2: 1,
                y2: 0,
                colorStops: [{
                  offset: 0,
                  color: '#6e4ed7' // 0% 处的颜色
                }, {
                  offset: 1,
                  color: '#dd78f3' // 100% 处的颜色
                }],
                global: false // 缺省为 false
              }
            }, //出现阴影
            lineStyle: {
              width: 6,

              color: { //线性渐变
                type: 'linear',
                x: 0,
                y: 0,
                x2: 1,
                y2: 1,
                colorStops: [{
                  offset: 0,
                  color: '#6e4ed7' // 0% 处的颜色
                }, {
                  offset: 1,
                  color: '#dd78f3' // 100% 处的颜色
                }],
                global: false // 缺省为 false
              }
            }
          }]

        };
        alarmTrend.setOption(alarmTrendOption);

      }, 200)

      //图表-弹出层-周界
      $('#showAround').on('mouseover',function(){
          var $tis = $(this);
          $tis.next('.popover').show(function(){
              var aroundChart = echarts.init(document.getElementById('aroundChart'))
              var aroundOption = {
                  width: 373,
                  height: 244,
                  legend: {
                      orient: 'vertical',
                      x: 'right',
                      y: '10%',
                      data:['灾害','劫持','突发'],
                      textStyle: {
                          color: '#ffffff'
                      }
                  },
                  series: [
                      {
                          type:'pie',
                          selectedMode: 'single',
                          radius: [0, '70%'],
                          data:[
                              {value:65, name:'灾害'},
                              {value:20, name:'劫持'},
                              {value:15, name:'突发', selected:true}
                          ]
                      }
                  ],
                  color: ['#7455f7','#ed544f','#d88156']
              };
              aroundChart.setOption(aroundOption);
          });
      }).on('mouseout',function(){
          $(this).next('.popover').hide();
      })

      //图表-弹出层-手按
      $('#showPress').on('mouseover',function(){
          var $tis = $(this);
          $tis.next('.popover').show(function(){
              var pressChart = echarts.init(document.getElementById('pressChart'))
              var pressOption = {
                  width: 373,
                  height: 244,
                  legend: {
                      orient: 'vertical',
                      x: 'right',
                      y: '10%',
                      data:['越狱','暴狱','袭击','灾害','劫持','突发'],
                      textStyle: {
                          color: '#ffffff'
                      }
                  },
                  series: [
                      {
                          type:'pie',
                          selectedMode: 'single',
                          radius: [0, '70%'],
                          data:[
                              {value:26, name:'越狱'},
                              {value:9, name:'暴狱'},
                              {value:24, name:'袭击'},
                              {value:11, name:'灾害'},
                              {value:20, name:'劫持'},
                              {value:10, name:'突发', selected:true}
                          ]
                      }
                  ],
                  color: ['#448dc4','#ed544f','#7455f7','#d88156','#325df9','#dbb44b']
              };
              pressChart.setOption(pressOption);
          });
      }).on('mouseout',function(){
          $(this).next('.popover').hide();
      })
      var mHeight = $('.data-middle').height();
      var unitHeight = mHeight / 3 - 40;
      var childHeight = unitHeight - 10;
      $('.dv-chart-main').css('height', unitHeight);
      $('.dv-chart-icons').css('height', unitHeight);
      $('.div-chart-bar,.duty-statistics, .police-trend,.dv-chart-duty-trend').css('height', childHeight);
      $('.dv-chart-icons').css('paddingTop', (unitHeight - 144)/2);

  </script>
</body>
</html>