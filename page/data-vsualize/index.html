<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>数据可视化</title>
  <link rel="stylesheet" href="../../asset/introduce/layui/css/layui.css">
  <link rel="stylesheet" href="../../asset/css/reset.css">
  <link rel="stylesheet" href="../../asset/css/common.css">
  <link rel="stylesheet" href="./index.css">
</head>
<body>
  <!--头部-->
  <div class="header">
    <a class="header-lt" id="header" href="../index/index.html"></a>
    <div class="header-rt">
      <ul>
        <li class="notice-wrapper">
          <img class="notice-icon" src="../../asset/img/notice.png" alt="通知">
        </li>
        <li class="user-notice">
          <div id="user-operate" class="user-operate">
            <a href="javascript:;">
              <img class="user-img" src="../../asset/img/logo.png" alt="头像">
              管理
            </a>
            <a href="javascript:;" class="exit" title="退出">退出</a>
          </div>
        </li>
      </ul>
    </div>
  </div>
  <!-- 固定勤务 -->
  <dl class="wrapper">
    <dd class="data-vsualize">
      <ul class="w30">
        <li class="dv-chart-box">
          <div class="dv-bg">
            <i class="dvbg-right-lt unormal"></i>
            <i class="dvbg-left-mt"></i>
            <i class="dvbg-left-rt"></i>
            <i class="dvbg-left-lm"><img src="../../asset/img/dv-left-lm-img.png"></i>
            <i class="dvbg-left-mm"></i>
            <i class="dvbg-left-rm"></i>
            <i class="dvbg-left-lb"></i>
            <i class="dvbg-left-mb"></i>
            <i class="dvbg-left-rb"></i>
          </div>
          <div class="dv-chart">
            <h4 class="dv-chart-title">近期报警统计</h4>
            <div class="dv-chart-main" id="alarmStatistics"></div>
          </div>
        </li>

        <li class="dv-chart-box dv-bg-center">
          <div class="dv-bg">
            <i class="dvbg-middle-lt"></i>
            <i class="dvbg-middle-rt"></i>
            <i class="dvbg-middle-rb"></i>
            <i class="dvbg-middle-lb"></i>
          </div>
          <div class="dv-in-chart">
            <h4 class="dv-chart-title">分类报警统计</h4>
            <div class="dv-chart-icons">
              <ul>
                <li>
                  周界
                  <span class="statis-around" id="showAround">1030</span>
                  <div class="popover popover-around">
                    <div class="pop-title">周界</div>
                    <div class="pop-chart" id="aroundChart"></div>
                  </div>
                </li>
              </ul>
              <ul>
                <li>
                  手按
                  <span class="statis-press" id="showPress">3200</span>
                  <div class="popover">
                    <div class="pop-title">手按</div>
                    <div class="pop-chart" id="pressChart"></div>
                  </div>
                </li>
              </ul>
              <ul>
                <li>
                  枪支离岗
                  <span class="statis-gun" id="qiangzhi">2000</span>
                </li>
              </ul>
            </div>
          </div>
        </li>

        <li class="dv-chart-box">
          <div class="dv-bg">
            <i class="dvbg-right-lt unormal"></i>
            <i class="dvbg-left-mt"></i>
            <i class="dvbg-left-rt"></i>
            <i class="dvbg-left-lm"><img src="../../asset/img/dv-left-lm-img.png"></i>
            <i class="dvbg-left-mm"></i>
            <i class="dvbg-left-rm"></i>
            <i class="dvbg-left-lb"></i>
            <i class="dvbg-left-mb"></i>
            <i class="dvbg-left-rb"></i>
          </div>
          <div class="dv-chart">
            <h4 class="dv-chart-title">近一年报警趋势</h4>
            <div class="dv-chart-main" id="alarmTrend"></div>
          </div>
        </li>
      </ul>

      <ul class="w70">
        <li class="dv-title">
          <i class="dvbg-title-l"></i>
          <i class="dvbg-title-m"></i>
          <i class="dvbg-title-r"></i>
          <img src="../../asset/img/dv-title.png" alt="数据可视化">
        </li>

        <li class="dv-table">
          <i class="bg-conner conner-lt"></i>
          <i class="bg-conner conner-rt"></i>
          <i class="bg-conner conner-lb"></i>
          <i class="bg-conner conner-rb"></i>
          <input type="text" name="notautosubmit" style="display:none"/>
          <form class="layui-form">
            <div class="layui-form-item">
              <div class="layui-inline">
                <label class="layui-form-label">开始时间：</label>
                <div class="layui-input-inline">
                  <input type="text" name="startTime" id="startTime" autocomplete="off" placeholder="开始时间"
                         class="layui-input js-laydate">
                </div>
              </div>

              <div class="layui-inline">
                <label class="layui-form-label">结束时间：</label>
                <div class="layui-input-inline">
                  <input type="text" name="endTime" id="endTime" autocomplete="off" placeholder="结束时间"
                         class="layui-input js-laydate">
                </div>
              </div>

              <div class="layui-inline">
                <label class="layui-form-label">报警类型：</label>
                <div class="layui-input-inline">
                  <select id="alarmType" name="alarmType">
                    <option value=""></option>
                    <option value="81">激光对射</option>
                    <option value="302">绊线入侵</option>
                    <option value="303">区域入侵</option>
                    <option value="309">快速移动</option>
                    <option value="594">声音异常</option>
                    <option value="596">攀高入侵</option>
                    <option value="2602">震动光纤</option>
                  </select>
                </div>
              </div>

              <div class="layui-inline">
                <label class="layui-form-label">报警级别：</label>
                <div class="layui-input-inline">
                  <select id="alarmLevel" name="alarmLevel">
                    <option value=""></option>
                    <option value="1">一级报警</option>
                    <option value="2">二级报警</option>
                    <option value="3">三级报警</option>
                  </select>
                </div>
              </div>

              <div class="layui-inline">
                <button type="button" class="layui-btn layui-btn-normal js-btn-search">查询</button>
                <!--<button class="layui-btn layui-btn-primary">导出</button>-->
              </div>

            </div>
          </form>
          <table class="layui-hide" id="alarmList"></table>
        </li>
      </ul>

      <span class="clearfix"></span>
    </dd>
  </dl>
  <script src="../../asset/js/jquery.min.js"></script>
  <script src="../../asset/js/config.js"></script>
  <script type='text/javascript' src='/dwr/engine.js'></script>
  <script type='text/javascript' src='/dwr/interface/DwrImpl.js'></script>
  <script type='text/javascript' src='/dwr/util.js'></script>
  <script src="../../asset/js/utils.js"></script>
  <script src="../../asset/js/echarts.min.js"></script>
  <script src="../../asset/introduce/layui/layui.js"></script>
  <script>
    var alarmDataCount = [];
    this.onLoad();
    function onLoad(){

      $.ajax({
        url: $ctx+"/alarm/getViewData",
        type: 'get',
        dataType: 'json',
        contentType: 'application/json',
        success: function (res) {
          var zhoujie=res.data.zhouJieCount;
          var shouan=res.data.shouAn;
          var qiangzhiligang=res.data.qiangzhi;
          $("#showAround").text(zhoujie);
          $("#showPress").text(shouan);
          $("#qiangzhi").text(zhoujie)

          for (var i=0; i<res.data.bData.length;i++){
            var data={};
            data.name=res.data.bData[i].name;
            data.value=parseFloat(res.data.bData[i].percent);
            alarmDataCount.push(data);
          }
          // 图表：近期报警统计
          var statisticsChart = echarts.init(document.getElementById('alarmStatistics'))
          var optionStatistics = {
            calculable : true,
            series : [
              {
                type:'pie',
                radius : [30, 110],
                center : ['50%', '50%'],
                roseType : 'radius',
                data: [
                  {value:35, name:'虚拟入侵 35%'},
                  {value:15, name:'激光对射 15%'},
                  {value:5, name:'绊线入侵 5%'},
                  {value:30, name:'徘徊滞留 30%'},
                  {value:15, name:'震动光纤 15%'},
                  {value:10, name:'声音异常 10%'}
                ]
              }
            ],
            color: ['#563ad2','#438dc3','#dab54c','#d78155','#325df9','#ed5450']
          };
          statisticsChart.setOption(optionStatistics);
          console.log(alarmDataCount)
        },
        error: function () {

        }
      })
    }


    layui.use(['laydate', 'table'], function () {
      var laydate = layui.laydate;
      $('.js-laydate').each(function(){
        var elm = $(this).attr('id');
        laydate.render({
          elem: '#' + elm,
          format: 'yyyy-MM-dd'
        })
      })

      var table = layui.table;
      $('body').on('click', '.js-btn-search', function () {
        renderTable();
      })
      renderTable();
      function renderTable(){
        var startTime = $('#startTime').val();
        var endTime = $('#endTime').val();
        var alarmType = $('#alarmType').val();
        var alarmLevel = $('#alarmLevel').val();
        var where = {
            startTime: startTime,
            endTime: endTime,
            alarmType: alarmType,
            alarmLevel: alarmLevel
          }
        table.render({
          elem: '#alarmList'
          ,url: $ctx + '/alarm/findAlarmList'
          ,method: 'get'
          ,page: true //开启分页
          ,layout: ['count', 'prev', 'page', 'next']
          ,skin: 'nob' //重要属性：无连线表格
          ,cols: [[ //标题栏
            {type:'checkbox', width: 50}
            ,{type:  'numbers', title: '序号', width: 70}
            ,{field: 'cameraID', title: '报警通道', minWidth: 120}
            ,{field: 'typeName', title: '报警类型', style: 'color: #f69506;', width: 100}
            ,{field: 'alarmTime', title: '报警时间', minWidth: 120}
            ,{field: 'levelName', title: '报警级别', style: 'color: #07dcef;', width: 100}
            ,{field: 'processResult', title: '处理结果', width: 100}
            ,{field: 'processTime', title: '处理时间', minWidth: 120}
          ]],
          parseData: function(res){ //res 即为原始返回的数据
            return {
              "code": res.code, //解析接口状态
              "msg": res.message, //解析提示文本
              "count": res.data.total, //解析数据长度
              "data": res.data.list //解析数据列表
            };
          },
          where: where
        });
      }
    })



    //图表-弹出层-周界
    $('#showAround').on('mouseover',function(){
      var $tis = $(this);
      $tis.next('.popover').show(function(){
        var aroundChart = echarts.init(document.getElementById('aroundChart'))
        var aroundOption = {
          width: 373,
          height: 244,
          legend: {
            orient: 'vertical',
            x: 'right',
            y: '10%',
            data:['灾害','劫持','突发'],
            textStyle: {
              color: '#ffffff'
            }
          },
          series: [
            {
              type:'pie',
              selectedMode: 'single',
              radius: [0, '70%'],
              data:[
                {value:65, name:'灾害'},
                {value:20, name:'劫持'},
                {value:15, name:'突发', selected:true}
              ]
            }
          ],
          color: ['#7455f7','#ed544f','#d88156']
        };
        aroundChart.setOption(aroundOption);
      });
    }).on('mouseout',function(){
      $(this).next('.popover').hide();
    })

    //图表-弹出层-手按
    $('#showPress').on('mouseover',function(){
      var $tis = $(this);
      $tis.next('.popover').show(function(){
        var pressChart = echarts.init(document.getElementById('pressChart'))
        var pressOption = {
          width: 373,
          height: 244,
          legend: {
            orient: 'vertical',
            x: 'right',
            y: '10%',
            data:['越狱','暴狱','袭击','灾害','劫持','突发'],
            textStyle: {
              color: '#ffffff'
            }
          },
          series: [
            {
              type:'pie',
              selectedMode: 'single',
              radius: [0, '70%'],
              data:[
                {value:26, name:'越狱'},
                {value:9, name:'暴狱'},
                {value:24, name:'袭击'},
                {value:11, name:'灾害'},
                {value:20, name:'劫持'},
                {value:10, name:'突发', selected:true}
              ]
            }
          ],
          color: ['#448dc4','#ed544f','#7455f7','#d88156','#325df9','#dbb44b']
        };
        pressChart.setOption(pressOption);
      });
    }).on('mouseout',function(){
      $(this).next('.popover').hide();
    })

    // 图表：近一年报警趋势
    var trendChart = echarts.init(document.getElementById('alarmTrend'));
    var optionTrend = {
      xAxis: {
        type: 'category',
        data: ['1月', '2月', '3月', '4月', '5月'],
        axisLine: {
          show: false
        },
        axisLabel: {
          color: '#e5ebff'
        },
        axisTick: {
          show: false
        },
        boundaryGap: false //顶头渲染
      },
      yAxis: [{
        type: 'value',
        axisLine: {
          show: false
        },
        axisLabel: {
          color: '#e5ebff'
        },
        axisTick: {
          show: false
        },
        splitLine: {
          show: true,
          lineStyle: {
            color: ['#22366d'],
            width: 1,
            type: 'solid'
          }
        }
      }],
      grid: {
        top: '13%',
        bottom: '16%',
        left: '10%',
        right: '3%',
      },
      series: [{
        data: [54, 43.2, 57.1, 63.5, 52.90],
        type: 'line',
        smooth: true, //折现光滑
        symbol: 'none', //取消这点圆圈
        areaStyle: {
          opacity: 0.2,
          color: { //线性渐变
            type: 'linear',
            x: 0,
            y: 0,
            x2: 1,
            y2: 0,
            colorStops: [{
              offset: 0,
              color: '#dd78f3' // 0% 处的颜色
            }, {
              offset: 1,
              color: '#6e4ed7' // 100% 处的颜色
            }],
            global: false // 缺省为 false
          }
        }, //出现阴影
        lineStyle: {
          width: 6,

          color: { //线性渐变
            type: 'linear',
            x: 0,
            y: 0,
            x2: 1,
            y2: 1,
            colorStops: [{
              offset: 0,
              color: '#dd78f3' // 0% 处的颜色
            }, {
              offset: 1,
              color: '#6e4ed7' // 100% 处的颜色
            }],
            global: false // 缺省为 false
          }
        }
      }]

    };
    trendChart.setOption(optionTrend);


  </script>
</body>
</html>